<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Type-level Collatz Sequence - Adventures in Typescript</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Type-level Collatz Sequence" />
<meta property="og:description" content="The Collatz conjecture is an unsolved problem in mathematics. It states that for any positive integer n, the sequence of numbers generated by the following algorithm will eventually reach 1. These are also called the hailstone numbers.
function collatz(n: number): number { return n % 2 === 0 ? n / 2 : 3 * n &#43; 1; } The sequence generated by a given $n$ is the sequence of numbers n, collatz(n), collatz(collatz(n)), collatz(collatz(collatz(n))), and so on." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://code.lol/post/programming/type-level-collatz/" /><meta property="og:image" content="https://code.lol/img/art/riding-digital-waves.png"/><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-12-08T22:58:35-08:00" />
<meta property="article:modified_time" content="2022-12-08T22:58:35-08:00" />

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	<link rel="stylesheet" href="/css/custom.css">

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="Adventures in Typescript" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">Adventures in Typescript</div>
					<div class="logo__tagline">Mike&#39;s code blog.</div>
				</div>
		</a>
	</div>
		
<nav class="menu">
	<button class="menu__btn" aria-haspopup="true" aria-expanded="false" tabindex="0">
		<span class="menu__btn-title" tabindex="-1">Menu</span>
	</button>
	<ul class="menu__list">
		<li class="menu__item">
			<a class="menu__link" href="/about/">
				
				<span class="menu__text">About Me</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/contact/">
				
				<span class="menu__text">Contact</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/papers/">
				
				<span class="menu__text">Papers</span>
				
			</a>
		</li>
	</ul>
</nav>

	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Type-level Collatz Sequence</h1>
			
		</header>
		<div class="content post__content clearfix">
			<p>The <em>Collatz conjecture</em> is an unsolved problem in mathematics. It states that for any positive integer <code>n</code>, the sequence of numbers generated by the following algorithm will eventually reach <code>1</code>. These are also called the <em>hailstone numbers</em>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ts" data-lang="ts"><span style="display:flex;"><span><span style="color:#080;font-weight:bold">function</span> collatz(n: <span style="color:#339;font-weight:bold">number</span>)<span style="color:#333">:</span> <span style="color:#339;font-weight:bold">number</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#080;font-weight:bold">return</span> n <span style="color:#333">%</span> <span style="color:#00d;font-weight:bold">2</span> <span style="color:#333">===</span> <span style="color:#00d;font-weight:bold">0</span> <span style="color:#333">?</span> n <span style="color:#333">/</span> 2 : <span style="color:#339;font-weight:bold">3</span> <span style="color:#333">*</span> n <span style="color:#333">+</span> <span style="color:#00d;font-weight:bold">1</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>The sequence generated by a given $n$ is the sequence of numbers <code>n</code>, <code>collatz(n)</code>, <code>collatz(collatz(n))</code>, <code>collatz(collatz(collatz(n)))</code>, and so on. This is known as the <em>Collatz sequence</em> of $n$, and ends when &lsquo;1&rsquo; is reached.</p>
<h2 id="typescript">Typescript</h2>
<p>This sequence serves as an entertaining challenge for performing type-level arithmetic, including addition, multiplication, and conditional logic.</p>
<p>Additionally, since even small numbers may generate large sequences, this serves as a benchmark for the performance and depth-limit of type-level computations.</p>
<h2 id="method">Method</h2>
<p>The method I used was to compose various type-level operations into a single type-level function, which I called <code>Collatz</code>. This function takes a type <code>N</code> and returns the next element in the Collatz sequence of <code>N</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ts" data-lang="ts"><span style="display:flex;"><span><span style="color:#080;font-weight:bold">import</span> { $, Kind, Conditional, <span style="color:#007020">Function</span>, NaturalNumber } <span style="color:#080;font-weight:bold">from</span> <span style="background-color:#fff0f0">&#34;hkt-toolbelt&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#080;font-weight:bold">export</span> <span style="color:#080;font-weight:bold">type</span> Collatz <span style="color:#333">=</span> Conditional.If<span style="color:#333">&lt;</span>
</span></span><span style="display:flex;"><span>  NaturalNumber.IsEven,
</span></span><span style="display:flex;"><span>  $&lt;<span style="color:#070">NaturalNumber.DivideBy</span><span style="color:#f00;background-color:#faa">,</span> <span style="color:#00c">2</span>&gt;,
</span></span><span style="display:flex;"><span>  Kind.Pipe<span style="color:#333">&lt;</span>[$&lt;<span style="color:#070">NaturalNumber.Multiply</span><span style="color:#f00;background-color:#faa">,</span> <span style="color:#00c">3</span>&gt;, NaturalNumber.Increment]<span style="color:#333">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#333">&gt;</span>;
</span></span></code></pre></div><p>These modules come from my library <a href="http://hkt.code.lol">hkt-toolbelt</a>. Essentially, these higher-order types compose to form a point-free programming language. All modules are highly optimized for performance and type inference.</p>
<p>For generating the <code>CollatzSequence</code>, I used a fixed point combinator variant that I call <code>FixSequence</code>, which takes a homomorphic higher-order type $F$ and an initial value $n$ and returns the sequence $[n, F(n), F^2(n), F^3(n), &hellip;]$ until the sequence reaches a fixed point (if it ever does).</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ts" data-lang="ts"><span style="display:flex;"><span><span style="color:#080;font-weight:bold">import</span> { $, Kind, Combinator, Conditional, <span style="color:#007020">Function</span>, NaturalNumber } <span style="color:#080;font-weight:bold">from</span> <span style="background-color:#fff0f0">&#34;..&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#080;font-weight:bold">export</span> <span style="color:#080;font-weight:bold">type</span> CollatzSequence <span style="color:#333">=</span> $<span style="color:#333">&lt;</span>
</span></span><span style="display:flex;"><span>  Combinator.FixSequence,
</span></span><span style="display:flex;"><span>  Conditional.If&lt;<span style="color:#070">Conditional.Equals</span><span style="color:#f00;background-color:#faa">&lt;</span><span style="color:#00c">1</span>&gt;, <span style="color:#007020">Function</span>.Constant&lt;<span style="color:#070">1</span>&gt;, Collatz<span style="color:#333">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#333">&gt;</span>;
</span></span></code></pre></div><h2 id="results">Results</h2>
<p>The screenshot below shows type inference for the Collatz sequence of $n = 871$, which has a sequence length of 179.</p>
<p><img src="/img/programming/type-level-collatz.png" alt=""></p>
<p>The implementation even supports initial values into the millions:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ts" data-lang="ts"><span style="display:flex;"><span><span style="color:#080;font-weight:bold">import</span> { $, NaturalNumberTheory } <span style="color:#080;font-weight:bold">from</span> <span style="background-color:#fff0f0">&#34;hkt-toolbelt&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#080;font-weight:bold">type</span> R <span style="color:#333">=</span> $&lt;<span style="color:#070">NaturalNumberTheory.CollatzSequence</span><span style="color:#f00;background-color:#faa">,</span> <span style="color:#00c">3_732_423</span>&gt;[<span style="background-color:#fff0f0">&#34;length&#34;</span>]; <span style="color:#888">// 597
</span></span></span></code></pre></div><h2 id="access">Access</h2>
<p>The <code>Collatz</code> and <code>CollatzSequence</code> utilities are available in the <code>NaturalNumberTheory</code> module of <a href="http://hkt.code.lol">hkt-toolbelt</a>.</p>

		</div>
		<footer class="post__footer">
			
<div class="post__tags tags clearfix">
	<svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5 0 11V3C0 1.5.8.8.8.8S1.5 0 3 0h8c1.5 0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/></svg>
	<ul class="tags__list">
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/typescript/" rel="tag">typescript</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/type-system/" rel="tag">type-system</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/number-theory/" rel="tag">number-theory</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/functional-programming/" rel="tag">functional-programming</a>
		</li>
	</ul>
</div>
		</footer>
	</article>
</main>

<div class="authorbox clearfix">
	<figure class="authorbox__avatar">
		<img alt="Michael Poteat avatar" src="/img/avatar.png" class="avatar" height="90" width="90">
	</figure>
	<div class="authorbox__header">
		<span class="authorbox__name">About Michael Poteat</span>
	</div>
	<div class="authorbox__description">
		Software engineer and researcher in SF. Interests in machine learning, programming, pure mathematics and many other topics.
	</div>
</div>



			</div>
			<aside class="sidebar"><div class="widget-search widget">
	<form class="widget-search__form" role="search" method="get" action="https://google.com/search">
		<label>
			<input class="widget-search__field" type="search" placeholder="SEARCH…" value="" name="q" aria-label="SEARCH…">
		</label>
		<input class="widget-search__submit" type="submit" value="Search">
		<input type="hidden" name="sitesearch" value="https://code.lol">
	</form>
</div>
<div class="widget-recent widget">
	<h4 class="widget__title">Recent Posts</h4>
	<div class="widget__content">
		<ul class="widget__list">
			<li class="widget__item"><a class="widget__link" href="/post/programming/kind-reification/">Kind Reification</a></li>
			<li class="widget__item"><a class="widget__link" href="/post/life/neurostochastic-panpsychism/">Neurostochastic Panpsychism</a></li>
			<li class="widget__item"><a class="widget__link" href="/post/programming/type-level-collatz/">Type-level Collatz Sequence</a></li>
			<li class="widget__item"><a class="widget__link" href="/post/programming/typesafe-function-composition/">Typesafe Function Composition</a></li>
			<li class="widget__item"><a class="widget__link" href="/post/programming/plugin-architecture/">Towards a well-typed plugin architecture</a></li>
		</ul>
	</div>
</div>
<div class="widget-categories widget">
	<h4 class="widget__title">Categories</h4>
	<div class="widget__content">
		<ul class="widget__list">
			<li class="widget__item">
				<a class="widget__link" href="/categories/algorithms/">algorithms</a></li>
			<li class="widget__item">
				<a class="widget__link" href="/categories/bioinformatics/">bioinformatics</a></li>
			<li class="widget__item">
				<a class="widget__link" href="/categories/life/">life</a></li>
			<li class="widget__item">
				<a class="widget__link" href="/categories/mathematics/">mathematics</a></li>
			<li class="widget__item">
				<a class="widget__link" href="/categories/programming/">programming</a></li>
			<li class="widget__item">
				<a class="widget__link" href="/categories/simulation/">simulation</a></li>
			<li class="widget__item">
				<a class="widget__link" href="/categories/typescript/">typescript</a></li>
		</ul>
	</div>
</div>
<div class="widget-taglist widget">
	<h4 class="widget__title">Tags</h4>
	<div class="widget__content">
		<a class="widget-taglist__link widget__link btn" href="/tags/algorithms/" title="algorithms">algorithms</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/architecture/" title="architecture">architecture</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/consciousness/" title="consciousness">consciousness</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/curves/" title="curves">curves</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/demo/" title="demo">demo</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/design-patterns/" title="design patterns">design patterns</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/dijkstra/" title="dijkstra">dijkstra</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/efficiency/" title="efficiency">efficiency</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/extensibility/" title="extensibility">extensibility</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/factorization/" title="factorization">factorization</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/functional-programming/" title="functional-programming">functional-programming</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/intelligence/" title="intelligence">intelligence</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/javascript/" title="javascript">javascript</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/lambda-calculus/" title="lambda calculus">lambda calculus</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/latex/" title="latex">latex</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/life/" title="life">life</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/math/" title="math">math</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/mathematica/" title="mathematica">mathematica</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/number-theory/" title="number theory">number theory</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/parsing/" title="parsing">parsing</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/performance/" title="performance">performance</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/philosophy/" title="philosophy">philosophy</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/physics/" title="physics">physics</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/point-free/" title="point-free">point-free</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/programming/" title="programming">programming</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/rationality/" title="rationality">rationality</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/regression/" title="regression">regression</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/safety/" title="safety">safety</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/strings/" title="strings">strings</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/tau-beta-pi/" title="tau-beta-pi">tau-beta-pi</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/tuples/" title="tuples">tuples</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/type-guard/" title="type-guard">type-guard</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/type-safety/" title="type safety">type safety</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/type-system/" title="type system">type system</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/typescript/" title="typescript">typescript</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/wip/" title="wip">wip</a>
	</div>
</div>
</aside>
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2023 Adventures in Typescript.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
	</div>
<script async defer src="/js/menu.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script>
</body>
</html>